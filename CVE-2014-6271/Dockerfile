FROM debian:buster

LABEL maintainer "sams.prashanth@gmail.com"

ENV DEBIAN_FRONTEND noninteractive
ENV LANG C.UTF-8
ENV LANGUAGE C.UTF-8
ENV LC_ALL C.UTF-8

RUN apt-get update -y && apt-get dist-upgrade -y
RUN apt-get install -y wget apache2 libtinfo5

RUN wget http://snapshot.debian.org/archive/debian/20130101T091755Z/pool/main/b/bash/bash_4.2%2Bdfsg-0.1_amd64.deb -O /tmp/bash_4.2+dfsg-0.1_amd64.deb && \
 dpkg -i /tmp/bash_4.2+dfsg-0.1_amd64.deb

ADD temp/index.html /var/www/html/
ADD temp/vulnerable /usr/lib/cgi-bin/
RUN cd /etc/apache2/mods-enabled && ln -s ../mods-available/cgi.load

RUN chown www-data:www-data /usr/lib/cgi-bin/vulnerable
RUN chmod u+x /usr/lib/cgi-bin/vulnerable

RUN apt-get autoremove && apt-get clean && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*

EXPOSE 80

CMD ["/usr/sbin/apache2ctl", "-DFOREGROUND"]